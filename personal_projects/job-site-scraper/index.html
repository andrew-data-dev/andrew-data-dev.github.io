<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>job site scraper ðŸ”Ž | andrew jacobson</title><meta name=keywords content="Personal,Web Development,Python,Web Scraping"><meta name=description content="A simple web scraping solution for tracking job postings from organizations that don&rsquo;t offer email alerts."><meta name=author content><link rel=canonical href=https://andrew-data-dev.github.io/personal_projects/job-site-scraper/><link crossorigin=anonymous href=/assets/css/stylesheet.a090830a421002426baafbd314e38f149d77b4c48a12ee9312700d770b27fb26.css integrity="sha256-oJCDCkIQAkJrqvvTFOOPFJ13tMSKEu6TEnANdwsn+yY=" rel="preload stylesheet" as=style><link rel=icon href=https://andrew-data-dev.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://andrew-data-dev.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://andrew-data-dev.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://andrew-data-dev.github.io/apple-touch-icon.png><link rel=mask-icon href=https://andrew-data-dev.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://andrew-data-dev.github.io/personal_projects/job-site-scraper/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:url" content="https://andrew-data-dev.github.io/personal_projects/job-site-scraper/"><meta property="og:site_name" content="andrew jacobson"><meta property="og:title" content="job site scraper ðŸ”Ž"><meta property="og:description" content="A simple web scraping solution for tracking job postings from organizations that donâ€™t offer email alerts."><meta property="og:locale" content="en-us"><meta property="og:type" content="article"><meta property="article:section" content="personal_projects"><meta property="article:tag" content="Personal"><meta property="article:tag" content="Web Development"><meta property="article:tag" content="Python"><meta property="article:tag" content="Web Scraping"><meta name=twitter:card content="summary"><meta name=twitter:title content="job site scraper ðŸ”Ž"><meta name=twitter:description content="A simple web scraping solution for tracking job postings from organizations that don&rsquo;t offer email alerts."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"personal projects","item":"https://andrew-data-dev.github.io/personal_projects/"},{"@type":"ListItem","position":2,"name":"job site scraper ðŸ”Ž","item":"https://andrew-data-dev.github.io/personal_projects/job-site-scraper/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"job site scraper ðŸ”Ž","name":"job site scraper ðŸ”Ž","description":"A simple web scraping solution for tracking job postings from organizations that don\u0026rsquo;t offer email alerts.","keywords":["Personal","Web Development","Python","Web Scraping"],"articleBody":"At the end of 2021, while searching for a new position, I wanted to be notified of new job postings at a few specific organizations. Unfortunately, these organizations didnâ€™t offer job alert subscriptions, they simply had web pages listing their openings.\nI created two separate scripts â€“ one for each job site â€“ primarily because the pages had different structures that required unique scraping logic. A future improvement would be consolidating everything into a single script, but my solution accomplished what I needed: it scraped the job websites every morning and emailed me the job title, description, and a direct link to each position.\nIâ€™ve included the code for one of the scripts below. It didnâ€™t seem substantial enough to warrant creating a dedicated GitHub repo!\nimport requests import smtplib import ssl import datetime import psycopg2 from bs4 import BeautifulSoup from time import sleep # This method logs in to Google SMTP server and sends an email. # Accepts a string parameter for the email message. def send_email(message, recipient): # Set up email connection port = smtp_port smtp_server = smtp_server_name sender_email = my_email receiver_email = recipient password = password # SSL context context = ssl.create_default_context() # Log in and send email with smtplib.SMTP_SSL(smtp_server, port, context=context) as server: server.login(sender_email, password) server.sendmail(sender_email, receiver_email, message) server.quit() # Open a connection to the specified database and return that connection def connect_to_db(): db_connection = psycopg2.connect( host=host_name, port=port, database=database_name, user=username, password=password ) return db_connection # MAIN LOGIC # # Current date today = datetime.date.today() print(\"\u003e\u003e\u003e Looking up jobs for\", today) # List to hold job listings job_listings = [] # Dictionary to hold jobs in memory job_dict = {} # Queries for staff jobs that contain the keywords url_queries = [\"https://www.somejobsite.com/postings/search?utf8=%E2%9C%93\u0026query=network\u0026query_v0_posted_at_date=\u0026query_position_type_id%5B%5D=1\u0026commit=Search\", \"https://www.somejobsite.com/postings/search?utf8=%E2%9C%93\u0026query=cyber\u0026query_v0_posted_at_date=\u0026query_position_type_id%5B%5D=1\u0026commit=Search\", \"https://www.somejobsite.com/postings/search?utf8=%E2%9C%93\u0026query=AWS\u0026query_v0_posted_at_date=\u0026query_position_type_id%5B%5D=1\u0026commit=Search\", \"https://www.somejobsite.com/postings/search?utf8=%E2%9C%93\u0026query=cloud\u0026query_v0_posted_at_date=\u0026query_position_type_id%5B%5D=1\u0026commit=Search\"] # Iterate through queries for url_query in url_queries: # Use 'requests' to retrieve web page try: webpage = requests.get(url_query) except Exception as error: print(\"Failed to request URL\", error) # Craft error email subject = \"Jobs Update Error\" message = \"Subject: {} \\n\\nError requesting a URL. See log.\".format(subject) recipient_email = my_email send_email(message, recipient_email) # Stop running script exit() # Create BeautifulSoup html parser object bsoup = BeautifulSoup(webpage.content, \"html.parser\") # Get the section of the page that has the job listings job_listings += bsoup.find_all(\"div\", class_=\"job-item job-item-posting\") # Iterate through the job listings for job_listing in job_listings: # Retrieve job title from: job_title = job_listing.get('data-posting-title') # Retrieve job description from: job_description = job_listing.find(\"span\", class_=\"job-description\").text.strip() # Retrieve the job's links from: job_urls = job_listing.find(\"span\", class_=\"job-actions\").find_all(\"a\", href=True) # Extract the first link from the job urls and create the link for the job's page job_page = \"https://www.somejobsite.com\" + job_urls[0][\"href\"] # Retrieve the details of the job from: job_details = job_listing.find_all(\"div\", class_=\"col-md-2 col-xs-12 job-title job-title-text-wrap col-md-push-2\") # Extract the associate job details posting_date = job_details[0].text.strip() job_number = int(job_details[2].text.strip()) department = job_details[3].text.strip() # Add the job to the in-memory dictionary job_dict[job_number] = [job_title, posting_date, department, job_page, job_description] # Wait 20 seconds sleep(20) # Check if job is old/new and update database accordingly # Connect to database and create cursor try: db_connection = connect_to_db() db_cursor = db_connection.cursor() except (Exception, psycopg2.Error) as error: print(\"Failed to connect to database\", error) # Define the insert query db_insert_query = \"\"\" INSERT INTO job_posting (N_JOB, D_ADDED, T_TITLE, D_POSTED, T_DEPARTMENT, U_PAGE, T_DESCRIPTION) VALUES (%s,%s,%s,%s,%s,%s,%s) \"\"\" # Define the query used to check if the record already exists db_select_check_query = \"\"\" SELECT 1 FROM job_posting WHERE N_JOB = %s \"\"\" # Copy job dictionary to a separate list for emails job_dict_to_email = job_dict.copy() # Iterate through the scraped jobs for job, job_details in job_dict.items(): # Check if job already exists in the database - the brackets are db_cursor.execute(db_select_check_query, [job]) db_row = db_cursor.fetchone() # If the record exists, remove the job listing from the dictionary to email if db_row is not None: # Remove job from the email dictionary job_dict_to_email.pop(job) # Else, add the record to the database else: # Assign job information to variables for columns n_job = job d_added = today t_title = job_details[0] d_posted = job_details[1] t_department = job_details[2] u_page = job_details[3] t_description = job_details[4] # Create insert record db_insert_record = (n_job, d_added, t_title, d_posted, t_department, u_page, t_description) # Insert the record try: db_cursor.execute(db_insert_query, db_insert_record) db_connection.commit() except (Exception, psycopg2.Error) as error: print(\"Failed to insert record\", error) # Disconnect from the database db_connection.close() # If the email dictionary has content, send email for remaining jobs if job_dict_to_email: # Craft email subject = \"Jobs Update \" + str(today) recipient_email = my_email message = \"Subject: {} \\n\\n\".format(subject) # Build message from job dictionary for job, job_details in job_dict_to_email.items(): title = job_details[0] posted = job_details[1] department = job_details[2] page_url = job_details[3] description = job_details[4] line = \"[{}] for {}\\n------------------------------\\n{}\\n\\n{}\\n\\n\\n\".format(title, department, description, page_url) message += line # Create message content with subject and the newly crafted body message = message.encode(\"utf-8\") # Call function to send email print(\"Sending email for\", today, \"with\", len(job_dict_to_email), \"job postings\") send_email(message, recipient_email) print(\"Email sent\") # Else, do nothing else: print(\"Nothing to email for\", today) ","wordCount":"833","inLanguage":"en","datePublished":"0001-01-01T00:00:00Z","dateModified":"0001-01-01T00:00:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"https://andrew-data-dev.github.io/personal_projects/job-site-scraper/"},"publisher":{"@type":"Organization","name":"andrew jacobson","logo":{"@type":"ImageObject","url":"https://andrew-data-dev.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://andrew-data-dev.github.io/ accesskey=h title="andrew jacobson (Alt + H)">andrew jacobson</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://andrew-data-dev.github.io/ title=about><span>about</span></a></li><li><a href=https://andrew-data-dev.github.io/personal_projects/ title="personal projects"><span>personal projects</span></a></li><li><a href=https://andrew-data-dev.github.io/posts/ title=posts><span>posts</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">job site scraper ðŸ”Ž</h1><div class=post-meta></div></header><div class=post-content><p>At the end of 2021, while searching for a new position, I wanted to be notified of new job postings at a few specific organizations. Unfortunately, these organizations didn&rsquo;t offer job alert subscriptions, they simply had web pages listing their openings.</p><p>I created two separate scripts &ndash; one for each job site &ndash; primarily because the pages had different structures that required unique scraping logic. A future improvement would be consolidating everything into a single script, but my solution accomplished what I needed: it scraped the job websites every morning and emailed me the job title, description, and a direct link to each position.</p><p>I&rsquo;ve included the code for one of the scripts below. It didn&rsquo;t seem substantial enough to warrant creating a dedicated GitHub repo!</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> requests
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> smtplib
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> ssl
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> datetime
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> psycopg2
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> bs4 <span style=color:#f92672>import</span> BeautifulSoup
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> time <span style=color:#f92672>import</span> sleep
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># This method logs in to Google SMTP server and sends an email.</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Accepts a string parameter for the email message.</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>send_email</span>(message, recipient):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Set up email connection</span>
</span></span><span style=display:flex><span>    port <span style=color:#f92672>=</span> smtp_port
</span></span><span style=display:flex><span>    smtp_server <span style=color:#f92672>=</span> smtp_server_name
</span></span><span style=display:flex><span>    sender_email <span style=color:#f92672>=</span> my_email
</span></span><span style=display:flex><span>    receiver_email <span style=color:#f92672>=</span> recipient
</span></span><span style=display:flex><span>    password <span style=color:#f92672>=</span> password
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># SSL context</span>
</span></span><span style=display:flex><span>    context <span style=color:#f92672>=</span> ssl<span style=color:#f92672>.</span>create_default_context()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Log in and send email</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>with</span> smtplib<span style=color:#f92672>.</span>SMTP_SSL(smtp_server, port, context<span style=color:#f92672>=</span>context) <span style=color:#66d9ef>as</span> server:
</span></span><span style=display:flex><span>        server<span style=color:#f92672>.</span>login(sender_email, password)
</span></span><span style=display:flex><span>        server<span style=color:#f92672>.</span>sendmail(sender_email, receiver_email, message)
</span></span><span style=display:flex><span>        server<span style=color:#f92672>.</span>quit()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Open a connection to the specified database and return that connection</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>connect_to_db</span>():
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    db_connection <span style=color:#f92672>=</span> psycopg2<span style=color:#f92672>.</span>connect(
</span></span><span style=display:flex><span>        host<span style=color:#f92672>=</span>host_name,
</span></span><span style=display:flex><span>        port<span style=color:#f92672>=</span>port,
</span></span><span style=display:flex><span>        database<span style=color:#f92672>=</span>database_name,
</span></span><span style=display:flex><span>        user<span style=color:#f92672>=</span>username,
</span></span><span style=display:flex><span>        password<span style=color:#f92672>=</span>password
</span></span><span style=display:flex><span>    )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> db_connection
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># MAIN LOGIC #</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Current date</span>
</span></span><span style=display:flex><span>today <span style=color:#f92672>=</span> datetime<span style=color:#f92672>.</span>date<span style=color:#f92672>.</span>today()
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>&#34;&gt;&gt;&gt; Looking up jobs for&#34;</span>, today)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># List to hold job listings</span>
</span></span><span style=display:flex><span>job_listings <span style=color:#f92672>=</span> []
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Dictionary to hold jobs in memory</span>
</span></span><span style=display:flex><span>job_dict <span style=color:#f92672>=</span> {}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Queries for staff jobs that contain the keywords</span>
</span></span><span style=display:flex><span>url_queries <span style=color:#f92672>=</span> [<span style=color:#e6db74>&#34;https://www.somejobsite.com/postings/search?utf8=</span><span style=color:#e6db74>%E</span><span style=color:#e6db74>2%9C%93&amp;query=network&amp;query_v0_posted_at_date=&amp;query_position_type_id%5B%5D=1&amp;commit=Search&#34;</span>,
</span></span><span style=display:flex><span>               <span style=color:#e6db74>&#34;https://www.somejobsite.com/postings/search?utf8=</span><span style=color:#e6db74>%E</span><span style=color:#e6db74>2%9C%93&amp;query=cyber&amp;query_v0_posted_at_date=&amp;query_position_type_id%5B%5D=1&amp;commit=Search&#34;</span>,
</span></span><span style=display:flex><span>               <span style=color:#e6db74>&#34;https://www.somejobsite.com/postings/search?utf8=</span><span style=color:#e6db74>%E</span><span style=color:#e6db74>2%9C%93&amp;query=AWS&amp;query_v0_posted_at_date=&amp;query_position_type_id%5B%5D=1&amp;commit=Search&#34;</span>,
</span></span><span style=display:flex><span>               <span style=color:#e6db74>&#34;https://www.somejobsite.com/postings/search?utf8=</span><span style=color:#e6db74>%E</span><span style=color:#e6db74>2%9C%93&amp;query=cloud&amp;query_v0_posted_at_date=&amp;query_position_type_id%5B%5D=1&amp;commit=Search&#34;</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Iterate through queries</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> url_query <span style=color:#f92672>in</span> url_queries:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Use &#39;requests&#39; to retrieve web page</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>try</span>:
</span></span><span style=display:flex><span>        webpage <span style=color:#f92672>=</span> requests<span style=color:#f92672>.</span>get(url_query)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>except</span> <span style=color:#a6e22e>Exception</span> <span style=color:#66d9ef>as</span> error:
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>&#34;Failed to request URL&#34;</span>, error)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># Craft error email</span>
</span></span><span style=display:flex><span>        subject <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Jobs Update Error&#34;</span>
</span></span><span style=display:flex><span>        message <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Subject: </span><span style=color:#e6db74>{}</span><span style=color:#e6db74> </span><span style=color:#ae81ff>\n\n</span><span style=color:#e6db74>Error requesting a URL. See log.&#34;</span><span style=color:#f92672>.</span>format(subject)
</span></span><span style=display:flex><span>        recipient_email <span style=color:#f92672>=</span> my_email
</span></span><span style=display:flex><span>        send_email(message, recipient_email)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># Stop running script</span>
</span></span><span style=display:flex><span>        exit()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Create BeautifulSoup html parser object</span>
</span></span><span style=display:flex><span>    bsoup <span style=color:#f92672>=</span> BeautifulSoup(webpage<span style=color:#f92672>.</span>content, <span style=color:#e6db74>&#34;html.parser&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Get the section of the page that has the job listings</span>
</span></span><span style=display:flex><span>    job_listings <span style=color:#f92672>+=</span> bsoup<span style=color:#f92672>.</span>find_all(<span style=color:#e6db74>&#34;div&#34;</span>, class_<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;job-item job-item-posting&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Iterate through the job listings</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> job_listing <span style=color:#f92672>in</span> job_listings:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># Retrieve job title from: &lt;div class=&#34;job-item job-item-posting&#34; data-posting-title=&#34;Communications Technician&#34;&gt;</span>
</span></span><span style=display:flex><span>        job_title <span style=color:#f92672>=</span> job_listing<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#39;data-posting-title&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># Retrieve job description from: &lt;span class=&#34;job-description&#34;&gt;</span>
</span></span><span style=display:flex><span>        job_description <span style=color:#f92672>=</span> job_listing<span style=color:#f92672>.</span>find(<span style=color:#e6db74>&#34;span&#34;</span>, class_<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;job-description&#34;</span>)<span style=color:#f92672>.</span>text<span style=color:#f92672>.</span>strip()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># Retrieve the job&#39;s links from: &lt;span class=&#34;job-actions&#34;&gt;</span>
</span></span><span style=display:flex><span>        job_urls <span style=color:#f92672>=</span> job_listing<span style=color:#f92672>.</span>find(<span style=color:#e6db74>&#34;span&#34;</span>, class_<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;job-actions&#34;</span>)<span style=color:#f92672>.</span>find_all(<span style=color:#e6db74>&#34;a&#34;</span>, href<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># Extract the first link from the job urls and create the link for the job&#39;s page</span>
</span></span><span style=display:flex><span>        job_page <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;https://www.somejobsite.com&#34;</span> <span style=color:#f92672>+</span> job_urls[<span style=color:#ae81ff>0</span>][<span style=color:#e6db74>&#34;href&#34;</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># Retrieve the details of the job from: &lt;div class=&#34;col-md-2 col-xs-12 job-title job-title-text-wrap col-md-push-2&#34;&gt;</span>
</span></span><span style=display:flex><span>        job_details <span style=color:#f92672>=</span> job_listing<span style=color:#f92672>.</span>find_all(<span style=color:#e6db74>&#34;div&#34;</span>, class_<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;col-md-2 col-xs-12 job-title job-title-text-wrap col-md-push-2&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># Extract the associate job details</span>
</span></span><span style=display:flex><span>        posting_date <span style=color:#f92672>=</span> job_details[<span style=color:#ae81ff>0</span>]<span style=color:#f92672>.</span>text<span style=color:#f92672>.</span>strip()
</span></span><span style=display:flex><span>        job_number <span style=color:#f92672>=</span> int(job_details[<span style=color:#ae81ff>2</span>]<span style=color:#f92672>.</span>text<span style=color:#f92672>.</span>strip())
</span></span><span style=display:flex><span>        department <span style=color:#f92672>=</span> job_details[<span style=color:#ae81ff>3</span>]<span style=color:#f92672>.</span>text<span style=color:#f92672>.</span>strip()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># Add the job to the in-memory dictionary</span>
</span></span><span style=display:flex><span>        job_dict[job_number] <span style=color:#f92672>=</span> [job_title, posting_date, department, job_page, job_description]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Wait 20 seconds</span>
</span></span><span style=display:flex><span>    sleep(<span style=color:#ae81ff>20</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Check if job is old/new and update database accordingly</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Connect to database and create cursor</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>try</span>:
</span></span><span style=display:flex><span>    db_connection <span style=color:#f92672>=</span> connect_to_db()
</span></span><span style=display:flex><span>    db_cursor <span style=color:#f92672>=</span> db_connection<span style=color:#f92672>.</span>cursor()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>except</span> (<span style=color:#a6e22e>Exception</span>, psycopg2<span style=color:#f92672>.</span>Error) <span style=color:#66d9ef>as</span> error:
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>&#34;Failed to connect to database&#34;</span>, error)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Define the insert query</span>
</span></span><span style=display:flex><span>db_insert_query <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;&#34;&#34; INSERT INTO job_posting (N_JOB, D_ADDED, T_TITLE, D_POSTED, T_DEPARTMENT, U_PAGE, T_DESCRIPTION) VALUES (</span><span style=color:#e6db74>%s</span><span style=color:#e6db74>,</span><span style=color:#e6db74>%s</span><span style=color:#e6db74>,</span><span style=color:#e6db74>%s</span><span style=color:#e6db74>,</span><span style=color:#e6db74>%s</span><span style=color:#e6db74>,</span><span style=color:#e6db74>%s</span><span style=color:#e6db74>,</span><span style=color:#e6db74>%s</span><span style=color:#e6db74>,</span><span style=color:#e6db74>%s</span><span style=color:#e6db74>) &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Define the query used to check if the record already exists</span>
</span></span><span style=display:flex><span>db_select_check_query <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;&#34;&#34; SELECT 1 FROM job_posting WHERE N_JOB = </span><span style=color:#e6db74>%s</span><span style=color:#e6db74> &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Copy job dictionary to a separate list for emails</span>
</span></span><span style=display:flex><span>job_dict_to_email <span style=color:#f92672>=</span> job_dict<span style=color:#f92672>.</span>copy()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Iterate through the scraped jobs</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> job, job_details <span style=color:#f92672>in</span> job_dict<span style=color:#f92672>.</span>items():
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Check if job already exists in the database - the brackets are</span>
</span></span><span style=display:flex><span>    db_cursor<span style=color:#f92672>.</span>execute(db_select_check_query, [job])
</span></span><span style=display:flex><span>    db_row <span style=color:#f92672>=</span> db_cursor<span style=color:#f92672>.</span>fetchone()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># If the record exists, remove the job listing from the dictionary to email</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> db_row <span style=color:#f92672>is</span> <span style=color:#f92672>not</span> <span style=color:#66d9ef>None</span>:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># Remove job from the email dictionary</span>
</span></span><span style=display:flex><span>        job_dict_to_email<span style=color:#f92672>.</span>pop(job)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Else, add the record to the database</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>        <span style=color:#75715e># Assign job information to variables for columns</span>
</span></span><span style=display:flex><span>        n_job <span style=color:#f92672>=</span> job
</span></span><span style=display:flex><span>        d_added <span style=color:#f92672>=</span> today
</span></span><span style=display:flex><span>        t_title <span style=color:#f92672>=</span> job_details[<span style=color:#ae81ff>0</span>]
</span></span><span style=display:flex><span>        d_posted <span style=color:#f92672>=</span> job_details[<span style=color:#ae81ff>1</span>]
</span></span><span style=display:flex><span>        t_department <span style=color:#f92672>=</span> job_details[<span style=color:#ae81ff>2</span>]
</span></span><span style=display:flex><span>        u_page <span style=color:#f92672>=</span> job_details[<span style=color:#ae81ff>3</span>]
</span></span><span style=display:flex><span>        t_description <span style=color:#f92672>=</span> job_details[<span style=color:#ae81ff>4</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># Create insert record</span>
</span></span><span style=display:flex><span>        db_insert_record <span style=color:#f92672>=</span> (n_job, d_added, t_title, d_posted, t_department, u_page, t_description)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># Insert the record</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span>:
</span></span><span style=display:flex><span>            db_cursor<span style=color:#f92672>.</span>execute(db_insert_query, db_insert_record)
</span></span><span style=display:flex><span>            db_connection<span style=color:#f92672>.</span>commit()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>except</span> (<span style=color:#a6e22e>Exception</span>, psycopg2<span style=color:#f92672>.</span>Error) <span style=color:#66d9ef>as</span> error:
</span></span><span style=display:flex><span>            print(<span style=color:#e6db74>&#34;Failed to insert record&#34;</span>, error)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Disconnect from the database</span>
</span></span><span style=display:flex><span>db_connection<span style=color:#f92672>.</span>close()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># If the email dictionary has content, send email for remaining jobs</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> job_dict_to_email:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Craft email</span>
</span></span><span style=display:flex><span>    subject <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Jobs Update &#34;</span> <span style=color:#f92672>+</span> str(today)
</span></span><span style=display:flex><span>    recipient_email <span style=color:#f92672>=</span> my_email
</span></span><span style=display:flex><span>    message <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Subject: </span><span style=color:#e6db74>{}</span><span style=color:#e6db74> </span><span style=color:#ae81ff>\n\n</span><span style=color:#e6db74>&#34;</span><span style=color:#f92672>.</span>format(subject)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Build message from job dictionary</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> job, job_details <span style=color:#f92672>in</span> job_dict_to_email<span style=color:#f92672>.</span>items():
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        title <span style=color:#f92672>=</span> job_details[<span style=color:#ae81ff>0</span>]
</span></span><span style=display:flex><span>        posted <span style=color:#f92672>=</span> job_details[<span style=color:#ae81ff>1</span>]
</span></span><span style=display:flex><span>        department <span style=color:#f92672>=</span> job_details[<span style=color:#ae81ff>2</span>]
</span></span><span style=display:flex><span>        page_url <span style=color:#f92672>=</span> job_details[<span style=color:#ae81ff>3</span>]
</span></span><span style=display:flex><span>        description <span style=color:#f92672>=</span> job_details[<span style=color:#ae81ff>4</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        line <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;[</span><span style=color:#e6db74>{}</span><span style=color:#e6db74>] for </span><span style=color:#e6db74>{}</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>------------------------------</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>{}</span><span style=color:#ae81ff>\n\n</span><span style=color:#e6db74>{}</span><span style=color:#ae81ff>\n\n\n</span><span style=color:#e6db74>&#34;</span><span style=color:#f92672>.</span>format(title, department, description, page_url)
</span></span><span style=display:flex><span>        message <span style=color:#f92672>+=</span> line
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Create message content with subject and the newly crafted body</span>
</span></span><span style=display:flex><span>    message <span style=color:#f92672>=</span> message<span style=color:#f92672>.</span>encode(<span style=color:#e6db74>&#34;utf-8&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Call function to send email</span>
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>&#34;Sending email for&#34;</span>, today, <span style=color:#e6db74>&#34;with&#34;</span>, len(job_dict_to_email), <span style=color:#e6db74>&#34;job postings&#34;</span>)
</span></span><span style=display:flex><span>    send_email(message, recipient_email)
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>&#34;Email sent&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Else, do nothing</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>&#34;Nothing to email for&#34;</span>, today)
</span></span></code></pre></div></div><footer class=post-footer><ul class=post-tags><li><a href=https://andrew-data-dev.github.io/tags/personal/>Personal</a></li><li><a href=https://andrew-data-dev.github.io/tags/web-development/>Web Development</a></li><li><a href=https://andrew-data-dev.github.io/tags/python/>Python</a></li><li><a href=https://andrew-data-dev.github.io/tags/web-scraping/>Web Scraping</a></li></ul><nav class=paginav><a class=prev href=https://andrew-data-dev.github.io/personal_projects/wordle-helper/><span class=title>Â« Prev</span><br><span>wordle helper ðŸŸ©â¬›â¬›ðŸŸ¨ðŸŸ¨</span>
</a><a class=next href=https://andrew-data-dev.github.io/personal_projects/wordlist-generator/><span class=title>Next Â»</span><br><span>password generator & wi-fi hacking ðŸ›œ</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://andrew-data-dev.github.io/>andrew jacobson</a></span> Â·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>